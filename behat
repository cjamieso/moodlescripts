#!/bin/bash
# behat

# For non-travis builds, start the jar and xvfb
if [ -z "$TRAVIS_BUILD_DIR" ];
then
    export DIR=/vagrant
    export YMLDIR=/b_moodledata/behat
    export DISPLAY=:10
    (java -jar /home/vagrant/selenium-server-standalone.jar > /dev/null 2>&1)& >/dev/null 2>&1
    (sudo Xvfb :10 -ac -noreset 2>/dev/null & )& > /dev/null 2>&1
else
    export DIR=$TRAVIS_BUILD_DIR
    export YMLDIR=/home/travis/roots/behat/behat
fi

# Check for piped input, otherwise use $1
read -t 1 dummy
if [ -z $dummy ];
then
    export TESTTYPE=$1
else
    export TESTTYPE=$dummy
fi

if [ "$TESTTYPE" = "analytics" ];
then
	echo "Starting report/analytics tests"
	$DIR/vendor/bin/behat --config $YMLDIR/behat.yml --tags @report_analytics
elif [ "$TESTTYPE" = "sg" ];
then
	echo "Starting blocks/skills_group tests"
	$DIR/vendor/bin/behat --config $YMLDIR/behat.yml --tags @block_skills_group
elif [ "$TESTTYPE" = "mail" ];
then
	echo "Starting blocks/course_message tests"
	$DIR/vendor/bin/behat --config $YMLDIR/behat.yml --tags @block_course_message
elif [ "$TESTTYPE" = "wip" ];
then
	echo "Starting work-in-progress tests"
	$DIR/vendor/bin/behat --config $YMLDIR/behat.yml --tags @wip
else
	echo "Test type not found"
fi

