#!/bin/bash

PHP=$(type -p php)

# For travis builds, use its home dir, otherwise use /vagrant
if [ -z "$TRAVIS_BUILD_DIR" ];
then
    export DIR=/vagrant
else
    export DIR=$TRAVIS_BUILD_DIR
fi

# Check $1 for type of tests, otherwise use the diff.
if [ -z "$1" ]; then
    export PLUGINS=$($PHP -f $DIR/moodlescripts/get_diff.php)
    read -ra arr <<<"$PLUGINS"
    for a in "${arr[@]}"; do
        export TESTTYPE="$a"
        cd $DIR && vendor/bin/phpunit -c $TESTTYPE && cd -
    done
else
    export TESTTYPE=$1
    cd $DIR && vendor/bin/phpunit -c $TESTTYPE && cd -
fi
